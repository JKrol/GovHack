<html>
<head>
<meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Angular Material style sheet -->
  <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/angular_material/1.1.1/angular-material.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  
  <link rel="stylesheet" href="style.css">
  
</head>
<body ng-app="HackApp" ng-controller="indexController" ng-cloak>

  <!-- App content -->
  <div style="max-height: 100%;" >

      <md-toolbar>
        <div class="md-toolbar-tools">
            <md-button ng-show="canNavigateBack()" ng-click="navigateBack()" aria-label="Go Back" class="md-icon-button">
              <md-icon class="material-icons">
                arrow_back
              </md-icon>
            </md-button>
          <h3 style="overflow: hidden; white-space: nowrap; text-overflow: ellipsis; width: 100%;">
            <span >{{title}}</span>
          </h3>
          <span flex></span>
          <md-menu ng-if="user">
            <md-button class="md-icon-button" aria-label="Menu" ng-click="openMenu($mdOpenMenu, $event)">
              <md-icon class="material-icons">
                more_vert
              </md-icon>
            </md-button>
            <md-menu-content width="4">
                <md-menu-item>
                  <md-button ng-click="navigate('settings')">
                     <md-icon class="material-icons">
                        settings
                     </md-icon>
                    Ustawienia
                  </md-button>
                </md-menu-item>
                 <md-menu-item>
                  <md-button ng-click="logout($event)">
                     <md-icon class="material-icons">
                        power_settings_new
                     </md-icon>
                    Wyloguj
                  </md-button>
                </md-menu-item>
            </md-menu-content>
          </md-menu>
        </div>
      </md-toolbar>

      <md-content style="max-height: calc(100% - 60px);" flex>
        <div ng-include src="currentTemplate" ng-cloak></div>
      </md-content>
  </div>
  <!-- App content -->

  <script   src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.16.1/lodash.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.1/moment.min.js"></script>

  <!-- Angular Material requires Angular.js Libraries -->
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-animate.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-aria.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-messages.min.js"></script>
  
  <!-- Angular Material Library -->
  <script src="http://ajax.googleapis.com/ajax/libs/angular_material/1.1.1/angular-material.min.js"></script>
  
  <script src="https://www.gstatic.com/firebasejs/3.2.1/firebase.js"></script>
  <!--<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>-->
 <script type="text/javascript" src="http://maps.google.com/maps/api/js?key=AIzaSyBCfu8xcjwcULhF8Pj2wrLvHEQicqKBais"></script>
 <script type="text/javascript" src="gmaps.js"></script>
 <script type="text/javascript" src="mymaps.js"></script>
 <script type="text/javascript" src="reservationApi.js"></script>
  <!-- <script src="https://maps.googleapis.com/maps/api/js?key="></script> -->

  <script src="js/config.js"></script>

  <script src="js/main.js"></script>

  <script src="js/databaseService.js"></script>

  <script src="js/loginController.js"></script>
  <script src="js/registerController.js"></script>
  <script src="js/mainController.js"></script>
  <script src="js/settingsController.js"></script>
  <script src="js/selectCategoryController.js"></script>
  <script src="js/selectCaseController.js"></script>
  <script src="js/mapController.js"></script>
  <script src="js/caseController.js"></script>
  <script src="js/navigateController.js"></script>
  <script src="js/reservationController.js"></script>
  <script src="js/userReservationController.js"></script>

  <script>
//      var map;
//      function initMap() {
//          map = new google.maps.Map(document.getElementById('map'), {
//              center: {lat: -34.397, lng: 150.644},
//              zoom: 8
//          });
//      }
  </script>

  <script type="text/ng-template" id="login.tpl">
	<div ng-controller="loginController" layout="column" ng-cloak class="md-inline-form" ng-cloak>
		<md-content layout-padding>
			<form name="loginForm">
				<md-input-container class="md-block">
					<label>Email</label>
					<input ng-model="userInput.email" type="text" name="email" required ng-pattern="/^.+@.+\..+$/" md-no-asterisk>
					<div ng-messages="loginForm.email.$error">
					  <div ng-message="required">To pole jest wymagane!</div>
					  <div ng-message="pattern">
						Wpisz poprawny adres email!
					  </div>
					</div>	
				</md-input-container>
				<md-input-container class="md-block">
					<label>Hasło</label>
					<input ng-model="userInput.password" type="password" name="password" required md-no-asterisk>
					<div ng-messages="loginForm.password.$error">
					  <div ng-message="required">To pole jest wymagane!</div>
					</div>	
				</md-input-container>
				<md-button class="md-primary" ng-click="navigate('register')">Zarejestruj</md-button>
				<md-button class="md-raised md-primary" ng-click="login()">Zaloguj</md-button>
			</form>
		</md-content>
	</div>
  </script>
  
  <script type="text/ng-template" id="register.tpl">
	<div ng-controller="registerController" layout="column" ng-cloak class="md-inline-form" ng-cloak>
		<md-content layout-padding>
			<form name="registerForm">
				<md-input-container class="md-block">
					<label>Email</label>
					<input ng-model="userInput.email" type="email" name="email" required ng-pattern="/^.+@.+\..+$/" md-no-asterisk>
					<div ng-messages="registerForm.email.$error">
					  <div ng-message="required">To pole jest wymagane!</div>
					  <div ng-message="pattern">
                          Wpisz poprawny adres email!
					  </div>
					</div>	
				</md-input-container>
				<md-input-container class="md-block">
					<label>Hasło</label>
					<input ng-model="userInput.password" type="password" name="password" required md-no-asterisk>
					<div ng-messages="registerForm.password.$error">
					  <div ng-message="required">To pole jest wymagane!</div>
					</div>	
				</md-input-container>
				<md-button class="md-raised md-primary" ng-click="createAccount()">Zarejestruj</md-button>
			</form>
		</md-content>
	</div>
  </script>

  <script type="text/ng-template" id="main.tpl">
      <div ng-controller="mainController" layout="column" ng-cloak>
          <md-content layout-padding>

              <md-list>
                  <md-subheader class="md-no-sticky">
                      Posiadasz {{cases.length}} spraw do załatwienia
                      <md-button class="md-raised md-primary" ng-click="navigate('navigate')">
                          Nawiguj
                      </md-button>
                  </md-subheader>
                  <md-list-item ng-repeat="item in cases track by item.id" class="md-3-line" style="maxheight: 100px;">
                      <div class="md-list-item-text" ng-click="viewDetails(item, $index)">
                          <h3>{{ item.name }}</h3>
                          <h4>{{item.progress}}</h4>
                          <p>{{item.deadlineStringToShow ? "Planowany termin: " + item.deadlineStringToShow : ""}}</p>
                      </div>
                      <md-button class="md-icon-button md-secondary md-warn" ng-click="remove($index)">
                          <md-icon class="material-icons">
                              delete
                          </md-icon>
                      </md-button>
                      <md-divider ng-if="!$last"></md-divider>
                  </md-list-item>
              </md-list>

              <md-button class="md-primary md-fab md-fab-bottom-right" ng-click="navigate('selectCategory')">
                  <md-icon class="material-icons">
                      add
                  </md-icon>
              </md-button>

          </md-content>
      </div>
  </script>

  <script type="text/ng-template" id="selectCategory.tpl">
      <div ng-controller="selectCategoryController" layout="column" ng-cloak>
          <md-content layout-padding>
              <div>

                  <md-autocomplete
                          md-selected-item="selectedItem"
                          md-selected-item-change="selectedItemChange(item)"
                          md-search-text="searchText"
                          md-items="item in querySearch(searchText)"
                          md-item-text="item.name"
                          placeholder="Szukaj..."
                          md-no-cache="true"
                          md-menu-class="autocomplete-custom-template">
                      <md-item-template>
						<span class="item-title">
							<span md-highlight-text="searchText" md-highlight-flags="ig">
								{{item.name}}
							</span>
						</span>
                      </md-item-template>
                      <md-not-found>
                          Nie znaleziono pasującej sprawy :(
                      </md-not-found>
                  </md-autocomplete>

              </div>
              <div >
                  <md-grid-list
                          md-cols-xs="2" md-cols-sm="3" md-cols-md="4" md-cols-gt-md="6"
                          md-row-height-gt-md="1:1" md-row-height="2:2"
                          md-gutter="12px" md-gutter-gt-sm="8px" >

                      <md-grid-tile ng-repeat="category in caseCategories track by category.id" ng-click="goToCategory(category)">
                          <!--http://image.flaticon.com/icons/svg/148/148744.svg-->
                          <!--<md-icon class="material-icons">-->
                              <!--assignment-->
                          <!--</md-icon>-->

                          <!--<md-icon md-svg-src="http://image.flaticon.com/icons/svg/148/148744.svg" class="s48" aria-label="Cart"    ></md-icon>-->

                          <img src="{{category.icon}}" style="width: 50%; height: 50%;"/>

                          <md-grid-tile-footer>
                              <h3>{{category.name}}</h3>
                          </md-grid-tile-footer>
                      </md-grid-tile>

                  </md-grid-list>
              </div>
          </md-content>
      </div>
  </script>

  <script type="text/ng-template" id="selectCase.tpl">
	<div ng-controller="selectCaseController" layout="column" ng-cloak>
		<md-content layout-padding>
			<div>

				<md-autocomplete
					md-selected-item="selectedItem"
					md-selected-item-change="selectedItemChange(item)"
					md-search-text="searchText"
					md-items="item in querySearch(searchText)"
					md-item-text="item.name"
					placeholder="Szukaj..."
					md-no-cache="true"
					md-menu-class="autocomplete-custom-template">
					<md-item-template>
						<span class="item-title">
							<span md-highlight-text="searchText" md-highlight-flags="ig">
								{{item.name}}
							</span>
						</span>
					</md-item-template>
					<md-not-found>
						Nie znaleziono pasującej sprawy :(
					</md-not-found>
				</md-autocomplete>
		  
			</div>

            <div>
                <md-list ng-cloak>
                    <md-list-item ng-repeat="case in cases track by case.id" style="margin-bottom: 20px;">

                        <md-checkbox ng-disabled="checkedDisabled.indexOf(case.id) >= 0"
                            class="md-primary"
                            aria-label="Checkbox"
                            ng-model="checked[case.id]">
                        </md-checkbox>

                        <p id="case-{{case.id}}"> {{case.name}} </p>

                    </md-list-item>

                </md-list>

            </div>

            <md-button class="md-primary md-fab md-fab-bottom-right" ng-click="confirm()">
                <md-icon class="material-icons">
                    done
                </md-icon>
            </md-button>
		</md-content>
	</div>
  </script>

  <script type="text/ng-template" id="caseDetails.tpl">
      <div ng-controller="caseController" layout="column" ng-cloak>
          <md-content layout-padding>
              <h2 class="md-title">{{case.name}}</h2>

              <md-list ng-cloak>
                  <md-subheader class="md-no-sticky" ng-click="showDeadline = !showDeadline">
                      <span ng-show="!showDeadline">+</span>
                      <span ng-show="showDeadline">-</span>
                      <md-icon class="material-icons">
                          date_range
                      </md-icon>
                      Termin
                  </md-subheader>
                  <md-list-item style="font-size: 12px;" ng-class="[{visible: showDeadline}, {hidden: !showDeadline}]" ng-show="showDeadline">
                      <p>
                          <md-input-container>
                              <label>Termin:</label>
                              <md-datepicker ng-model="userCase.deadline" ng-change="saveUserCase()"></md-datepicker>
                          </md-input-container>
                      </p>
                  </md-list-item>

                  <md-subheader class="md-no-sticky" ng-click="showCaseNumber = !showCaseNumber">
                      <span ng-show="!showCaseNumber">+</span>
                      <span ng-show="showCaseNumber">-</span>
                      <md-icon class="material-icons">
                          perm_identity
                      </md-icon>
                      Twój numer sprawy
                  </md-subheader>
                  <md-list-item ng-class="[{visible: showCaseNumber}, {hidden: !showCaseNumber}]" style="font-size: 12px;" ng-show="showCaseNumber" ng-if="editNr">
                      <p>
                          <md-input-container class="md-block" flex-gt-xs>
                              <label>Numer</label>
                              <input ng-model="userCase.number">
                              <md-button md-no-ink class="md-primary" ng-click="saveUserCase()">zapisz</md-button>
                          </md-input-container>
                      </p>
                  </md-list-item>
                  <md-list-item ng-class="[{visible: showCaseNumber}, {hidden: !showCaseNumber}]" style="font-size: 12px;" ng-show="showCaseNumber" ng-if="!editNr && userCase.number">
                      <p ng-if="!editNr && userCase.number" ng-click="editCaseNumber()">
                          {{userCase.number}}
                      </p>
                  </md-list-item>
                  <md-list-item ng-class="[{visible: showCaseNumber}, {hidden: !showCaseNumber}]" style="font-size: 12px;" ng-show="showCaseNumber" ng-if="!editNr && !userCase.number">
                      <p ng-if="!editNr && !userCase.number" ng-click="editCaseNumber()">
                          <md-button class="md-raised md-primary">dodaj</md-button>
                      </p>
                  </md-list-item>

                  <md-subheader class="md-no-sticky" ng-click="showResponseTime = !showResponseTime">
                      <span ng-show="!showResponseTime">+</span>
                      <span ng-show="showResponseTime">-</span>
                      <md-icon class="material-icons">
                          schedule
                      </md-icon>
                      Maksymalny czas oczekiwania
                  </md-subheader>
                  <md-list-item ng-class="[{visible: showResponseTime}, {hidden: !showResponseTime}]" style="font-size: 12px;" ng-show="showResponseTime">
                      <p> {{case.details.responseTime}} </p>
                  </md-list-item>

                  <md-subheader class="md-no-sticky" ng-click="showDocs = !showDocs">
                      <span ng-show="!showDocs">+</span>
                      <span ng-show="showDocs">-</span>
                      <md-icon class="material-icons">
                          list
                      </md-icon>
                      Wymagane dokumenty
                  </md-subheader>
                  <md-list-item ng-class="[{visible: showDocs}, {hidden: !showDocs}]" ng-repeat="doc in case.details.documents" style="font-size: 12px;" ng-show="showDocs">
                      <md-checkbox class="md-primary"
                                   ng-model="userCase.documents[doc.id]"
                                   ng-change="saveUserCase()">
                      </md-checkbox>
                      <p> {{$index + 1}}. {{ doc.name }} </p>
                  </md-list-item>

                  <md-subheader class="md-no-sticky" ng-click="showSteps = !showSteps">
                      <span ng-show="!showSteps">+</span>
                      <span ng-show="showSteps">-</span>
                      <md-icon class="material-icons">
                          assignment_turned_in
                      </md-icon>
                      Kroki
                  </md-subheader>
                  <md-list-item ng-class="[{visible: showSteps}, {hidden: !showSteps}]" ng-repeat="step in case.details.steps" style="font-size: 12px;" ng-show="showSteps">
                      <md-checkbox class="md-primary"
                                   ng-model="userCase.step[step.id]"
                                   ng-change="saveUserCase()">
                      </md-checkbox>
                      <p> {{$index + 1}}. {{ step.name }} </p>
                  </md-list-item>

                  <md-subheader class="md-no-sticky" ng-click="showComments = !showComments">
                      <span ng-show="!showComments">+</span>
                      <span ng-show="showComments">-</span>
                      <md-icon class="material-icons">
                          comment
                      </md-icon>
                      Uwagi
                  </md-subheader>
                  <md-list-item ng-class="[{visible: showComments}, {hidden: !showComments}]" ng-repeat="comment in case.details.comments" style="font-size: 12px;" ng-show="showComments">
                      <p> {{$index + 1}}. {{ comment.name }} </p>
                  </md-list-item>

                  <md-subheader class="md-no-sticky" ng-click="showPayments = !showPayments">
                      <span ng-show="!showPayments">+</span>
                      <span ng-show="showPayments">-</span>
                      <md-icon class="material-icons">
                          attach_money
                      </md-icon>
                      Opłaty
                  </md-subheader>
                  <md-list-item ng-class="[{visible: showPayments}, {hidden: !showPayments}]" style="font-size: 12px;" ng-show="showPayments">
                      <p> {{case.details.payments}} </p>
                  </md-list-item>
              </md-list>

          </md-content>
      </div>
  </script>

  <script type="text/ng-template" id="navigate.tpl">
      <div ng-controller="navigateController" layout="column" ng-cloak>
          <md-content layout-padding>
              <md-list class="md-dense" ng-cloak>
                  <div ng-repeat="item in cases track by item.id">
                      <md-subheader class="md-no-sticky" ng-click="item.showDeps = !item.showDeps">
                          <span ng-show="!item.showDeps">+</span>
                          <span ng-show="item.showDeps">-</span>
                          {{item.name}}
                      </md-subheader>

                      <md-list-item ng-class="['md-3-line', {visible: item.showDeps}, {hidden: !item.showDeps}]" ng-repeat="dep in item.details.departments track by dep.id" ng-show="item.showDeps">
                          <div class="md-list-item-text" layout="column">
                              <h3>{{ dep.name }}</h3>
                              <h4>Osób w kolejce: {{ dep.queueData.liczbaKlwKolejce }}</h4>
                              <p>Aktualny numer: {{ dep.queueData.aktualnyNumer }}</p>
                              <md-icon class="material-icons md-secondary" ng-click="openMap(dep)">
                                  navigation
                              </md-icon>
                          </div>
                      </md-list-item>

                      <md-divider></md-divider>
                  </div>
              </md-list>

              <md-button class="md-primary md-fab md-fab-bottom-right" ng-click="makeReservation()">
                  <md-icon class="material-icons">
                      event
                  </md-icon>
              </md-button>
          </md-content>
      </div>
  </script>

  <script type="text/ng-template" id="map.tpl">
      <div ng-controller="mapController" layout="column" style="min-width: 100%; min-height: 80%" ng-cloak>
          <div id="map" style="min-width: 100%; min-height: 50%"></div>
          <div class="mapDetails">
            <md-content layout-padding>
                <div layout="row" layout-sm="column" layout-align="space-around" ng-show="!steps">
                    <md-progress-circular md-mode="indeterminate"></md-progress-circular>
                </div>

                <md-list class="md-dense" ng-cloak ng-show="steps">
                    <md-subheader class="md-no-sticky">
                        Odległość: {{walkInfo.dist}}
                    </md-subheader>

                    <md-subheader class="md-no-sticky">
                        <md-icon class="material-icons md-secondary">
                            directions_walk
                        </md-icon>
                        {{walkInfo.dur}}
                    </md-subheader>

                    <md-subheader class="md-no-sticky">
                        <md-icon class="material-icons md-secondary">
                            drive_eta
                        </md-icon>
                        {{driveInfo.dur}}
                    </md-subheader>

                    <md-subheader class="md-no-sticky">
                        Komunikacja miejska:
                    </md-subheader>
                    <md-list-item class="md-3-line" ng-repeat="step in steps">
                        <img src="{{step.icon}}" />
                        {{step.short}} o {{step.time}}: {{step.from}} -> {{step.to}}
                    </md-list-item>
                </md-list>
            </md-content>
          </div>
      </div>
  </script>

  <script type="text/ng-template" id="reservation.tpl">
      <div ng-controller="reservationController" layout="column" ng-cloak>
          <md-content layout-padding>
              <div layout-gt-sm="row">
                  <h4 class="md-title">Zarejestruj się w kolejkach do wszystkich spraw</h4>
              </div>
              <div layout-gt-sm="row">
                  <md-input-container style="margin: 0px !important;">
                      <label>Termin:</label>
                      <md-datepicker ng-model="date"></md-datepicker>
                  </md-input-container>
              </div>
              <div layout-gt-sm="row">
                  <md-input-container style="margin-left: 18px; margin-right: 0px !important; width: 40%;">
                      <md-icon class="material-icons">
                          schedule
                      </md-icon>
                      <label>Godzina:</label>
                      <input type="time" ng-model="time" style="width: 100%;">
                  </md-input-container>
              </div>
              <div layout-gt-sm="row" style="text-align: center;">
                  <md-button class="md-raised md-warn" style="margin-top: 50px;" ng-click="reservation()">Zarezerwuj</md-button>
              </div>
          </md-content>
      </div>
  </script>

  <script type="text/ng-template" id="userReservations.tpl">
      <div ng-controller="userReservationsController" layout="column" ng-cloak>
          <md-content layout-padding>
              <md-list class="md-dense" ng-cloak ng-show="steps">
                  <div ng-repeat="item in reservations">

                  </div>
              </md-list>
          </md-content>
      </div>
  </script>

  <script type="text/ng-template" id="settings.tpl">
	<div ng-controller="settingsController" layout="column" ng-cloak>
		<md-content layout-padding>
			Hello {{user.email}}!
		</md-content>
	</div>
  </script>

</body>
</html>
